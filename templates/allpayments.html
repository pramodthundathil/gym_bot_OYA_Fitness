{% extends "index.html" %}
{% load static %}
{% static "images" as baseurl %}

{% block content %}

<div class="main-panel">
    <div class="content-wrapper pb-0">
        {% for message in messages  %}

        <div class="alert {{message.tags}} alert-dismissible fade show " style="position:fixed;top:100px;z-index:1;" role="alert">
            <strong>Information!</strong> {{message}}
            <button type="button" class="btn btn-close mdi mdi-close text-xxl" data-bs-dismiss="alert"
                aria-label="Close"></button>
        </div>
        {% endfor %}
        <div class="page-header flex-wrap">
            <h3 class="mb-0"> All Payments <span class="pl-0 h6 pl-sm-2 text-muted d-inline-block"></span>
            </h3>
        </div>

        <div class="row">
            <div class="col-xl-12 col-sm-6 grid-margin stretch-card">
                <div class="card">
                  <div class="card-body px-0 overflow-auto">
                    <h4 class="card-title pl-4">All Payments</h4>
                    <div class="table-responsive">
                      <table class="table" id="paymentTable">
                        <thead class="bg-light">
                          <tr>
                            <th>Sl No</th>
                            <th>Customer</th>
                            <th>Payment Amount</th>
                            <th>Mode Of Payment</th>
                            <th>Date</th>
                            <th>Status</th>
                            <th>Action</th>
                          </tr>
                        </thead>
                        <tbody>
                          {% for i in payments %}
                            
                          <tr>
                            <th>{{forloop.counter}}</th>
                            <td>
                              <div class="d-flex align-items-center">
                                <!-- <img src="{{i.Member.Photo.url}}" alt="image" /> -->
                                <div class="table-user-name ml-3">
                                  <p class="mb-0 font-weight-medium"> {{i.Member}} </p>
                                  <small> Payment done</small>
                                </div>
                              </div>
                            </td>
                            <td>
                              AED {{i.Amount}}
                              {% if i.Payment_Balance > 0 %}
                              <br>
                              <small class="text-danger">Payment Balance AED {{i.Payment_Balance}}</small> 
                              {% endif %}
                            </td>
                            <td>{{i.Mode_of_Payment}}</td>
                            <td>
{{i.Payment_Date}}
                            </td>
                            <td>
                              <div class="badge badge-inverse-success"> Completed </div>
                            </td>
                            <td>
                              <a href="{%url 'ReceiptGenerate' i.id %}" target="_blank" class="btn btn-outline-warning">Get Receipt</a>

                              <a data-bs-toggle="modal" data-bs-target="#staticBackdropsubperitype" data-bs-toggle="tooltip"
                              data-bs-placement="top" title="delete" class="btn btn-outline-danger btn-sm"><i class="mdi mdi-delete"
                                style="font-size: 15px;"></i></a>
                                {% if request.user.groups.all.0.name == "admin" %}
                                <a href="{%url 'EditPayment' i.id %}" class="btn btn-inverse-info btn-icon"
                                                data-bs-toggle="tooltip" data-bs-placement="top" title="Edit"><i
                                                    style="font-size: x-large;" class="bi bi-pencil-square"></i></a>
                                                  {% endif %}
                            </td>
                          </tr>
                              <!-- Modal Sub Period delete -->
                              <div class="modal fade" id="staticBackdropsubperitype" data-bs-backdrop="static"
                              data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel"
                              aria-hidden="true">
                              <div class="modal-dialog">
                                  <div class="modal-content">
        
                                      <div class="modal-body">
                                          Do you Want To delete payment ?
                                      </div>
                                      <div class="modal-footer">
                                          <button type="button" class="btn btn-secondary"
                                              data-bs-dismiss="modal">No</button>
                                          <a href="{%url 'DeletePayment' i.id %}" type="button"
                                              class="btn btn-danger">Yes</a>
                                      </div>
                                  </div>
                              </div>
                          </div>
                          {% endfor %}

                        </tbody>
                      </table>
                    </div>
                    <!-- <a class="text-black mt-3 d-block pl-4" href="#">
                      <span class="font-weight-medium h6">View all Payments</span>
                      <i class="mdi mdi-chevron-right"></i></a> -->
                  </div>
                </div>
              </div>
          </div> 
    </div>
</div>
<!-- jQuery (must be loaded first) -->
<script src="{%static 'assets\js\jquery-3.6.0.min.js' %}"></script>


<!-- DataTables CSS -->
<link rel="stylesheet" href="{%static 'assets\css\jquery.dataTables.min.css' %}">

<!-- DataTables JS (load after jQuery) -->
<script src="{%static 'assets\js\jquery.dataTables.min.js' %}"></script>

<script>
    $(document).ready(function() {
        if ($.fn.DataTable) {
            console.log("DataTable is loaded.");
            $('#paymentTable').DataTable();
        } else {
            console.error("DataTable is not loaded.");
        }
    });
</script>
</script>
{% endblock %}